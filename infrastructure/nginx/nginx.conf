events {
    worker_connections 1024;
}

http {
    # Tối ưu hóa xử lý request
    sendfile on;

    server {
        listen 80; # Cổng chính mở ra cho khách
        server_name localhost;

        # --- 1. ĐƯỜNG VÀO IDENTITY (Đăng nhập/Token) ---
        location /api/auth/ {
            # Chuyển tiếp đến container identity-service (cổng nội bộ 8080)
            proxy_pass http://identity-service:8080/api/auth/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # --- 2. ĐƯỜNG VÀO MEDICAL RECORD (Hồ sơ) ---
        location /api/patients/ {
            proxy_pass http://medical-record-service:8080/api/patients/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # --- 3. ĐƯỜNG VÀO IMAGING (Ảnh) ---
        location /api/images/ {
            proxy_pass http://imaging-service:8080/api/images/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # --- 4. ĐƯỜNG VÀO BILLING (Hóa đơn) ---
        location /api/bills/ {
            proxy_pass http://billing-service:8080/api/bills/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # --- 5. ĐƯỜNG VÀO NOTIFICATION (Thông báo) ---
        location /api/notifications/ {
            proxy_pass http://notification-service:8080/api/notifications/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # --- 6. (Tương lai) ĐƯỜNG VÀO AI CORE ---
        # location /api/ai/ {
        #     proxy_pass http://ai-core-service:5000/;
        # }
    }
}